# 필요한 라이브러리 임포트
import faiss
import numpy as np
from sentence_transformers import SentenceTransformer

# 제목과 조치사항을 포함한 딕셔너리 데이터 준비
responses = [
    {
        "title": "갤럭시폰의 전원이 켜지지 않습니다.",
        "action": "전원 버튼을 길게 눌러 보세요. 그래도 켜지지 않으면 충전기를 연결하고 잠시 기다렸다가 다시 시도해 보세요. 여전히 문제가 지속되면 서비스 센터 방문을 권장합니다."
    },
    {
        "title": "갤럭시폰 화면에 줄이 생겼어요.",
        "action": "화면 보호 필름을 제거하고, 화면을 깨끗하게 닦아보세요. 문제가 해결되지 않으면 제품을 점검 받아보세요."
    },
    {
        "title": "갤럭시폰 소리가 나오지 않아요.",
        "action": "음량 설정 및 음소거 여부를 확인하고, 이어폰이나 스피커를 연결해 문제를 확인해 보세요."
    },
    {
        "title": "갤럭시폰 배터리 충전이 제대로 되지 않습니다.",
        "action": "충전 포트를 깨끗하게 청소하고, 다른 충전 케이블과 어댑터를 사용해 보세요. 문제가 지속될 경우 배터리 점검을 받아보세요."
    },
    {
        "title": "갤럭시폰이 과열되는 것 같아요.",
        "action": "백그라운드에서 실행 중인 앱을 종료하고, 환기가 잘 되는 곳에서 사용해 보세요. 과열이 계속되면 점검이 필요합니다."
    },
    {
        "title": "갤럭시폰 터치가 반응하지 않습니다.",
        "action": "화면 보호 필름을 제거하고, 손을 깨끗이 씻은 후 다시 시도해 보세요. 여전히 문제가 있으면 서비스 센터를 방문하세요."
    },
    {
        "title": "갤럭시폰 앱이 자꾸 강제 종료됩니다.",
        "action": "앱을 업데이트하거나 재설치해 보세요. 그래도 문제가 지속되면 캐시를 지우고, 필요시 공장 초기화를 고려해 보세요."
    },
    {
        "title": "갤럭시폰 카메라가 작동하지 않습니다.",
        "action": "카메라 앱을 재시작하고, 여전히 문제가 있으면 캐시를 지우거나, 소프트웨어 업데이트를 확인해 보세요."
    },
    {
        "title": "갤럭시폰의 Wi-Fi 연결이 불안정합니다.",
        "action": "Wi-Fi 라우터를 재부팅하고, 다른 네트워크에 연결해 보세요. 설정에서 네트워크를 초기화할 수도 있습니다."
    },
    {
        "title": "갤럭시폰 블루투스 연결이 안 됩니다.",
        "action": "블루투스 설정을 확인하고, 페어링된 기기를 삭제 후 다시 연결해 보세요. 필요시 기기 재부팅을 시도해 보세요."
    },
    {
        "title": "갤럭시폰의 알림이 오지 않습니다.",
        "action": "알림 설정을 확인하고, 방해 금지 모드가 켜져 있는지 확인해 보세요. 여전히 문제가 있으면 소프트웨어 업데이트를 확인하세요."
    },
    {
        "title": "갤럭시폰의 GPS가 작동하지 않습니다.",
        "action": "GPS 설정을 확인하고, 위치 서비스를 재부팅해 보세요. 필요시 다른 위치 서비스 앱을 사용해 보세요."
    },
    {
        "title": "갤럭시폰 화면이 깜빡거립니다.",
        "action": "밝기 설정을 조정하고, 자동 밝기 기능을 끄세요. 문제가 지속되면 서비스 센터에서 점검을 받으세요."
    },
    {
        "title": "갤럭시폰에서 데이터가 전송되지 않습니다.",
        "action": "모바일 데이터 설정을 확인하고, 비행기 모드가 꺼져 있는지 확인해 보세요. 문제가 해결되지 않으면 APN 설정을 재구성하세요."
    },
    {
        "title": "갤럭시폰의 앱 다운로드가 안 됩니다.",
        "action": "스토리지 공간을 확인하고, 인터넷 연결 상태를 확인해 보세요. 필요시 앱 스토어 캐시를 지우세요."
    },
    {
        "title": "갤럭시폰에서 사진이 저장되지 않습니다.",
        "action": "저장 공간을 확인하고, 갤러리 앱의 설정을 확인해 보세요. 문제가 지속되면 SD 카드 상태를 확인하세요."
    },
    {
        "title": "갤럭시폰의 터치 ID가 작동하지 않습니다.",
        "action": "터치 ID 설정을 확인하고, 손가락을 깨끗이 씻은 후 다시 시도해 보세요. 문제가 지속되면 지문을 다시 등록해 보세요."
    },
    {
        "title": "갤럭시폰의 화면이 잠기지 않습니다.",
        "action": "잠금 화면 설정을 확인하고, 화면 잠금 기능을 다시 설정해 보세요. 문제가 지속되면 소프트웨어 업데이트를 확인하세요."
    },
    {
        "title": "갤럭시폰의 통화가 끊깁니다.",
        "action": "신호 강도를 확인하고, SIM 카드를 다시 삽입해 보세요. 필요시 네트워크 설정을 초기화하세요."
    },
    {
        "title": "갤럭시폰의 문자 메시지가 보내지지 않습니다.",
        "action": "문자 메시지 설정을 확인하고, SMS 센터 번호가 올바른지 확인하세요. 필요시 네트워크 설정을 초기화하세요."
    }
]


# 텍스트 임베딩을 위한 모델 로드
model = SentenceTransformer('all-MiniLM-L6-v2')
titles = [response["title"] for response in responses]
embeddings = model.encode(titles)

# FAISS 인덱스 생성 및 벡터 추가
dimension = embeddings.shape[1]
index = faiss.IndexFlatL2(dimension)
index.add(embeddings)

# 예제 질의
query = "휴대폰 화면이 이상해요."
query_vector = model.encode([query])

# FAISS를 사용해 유사한 제목 검색 (Top 3)
k = 3  # 상위 3개 유사한 제목 출력
distances, indices = index.search(query_vector, k)

# 검색 결과 출력
print(f"질의: {query}")
print("유사한 A/S 응답:")
for idx, (dist, index) in enumerate(zip(distances[0], indices[0])):
    title = responses[index]["title"]
    action = responses[index]["action"]
    print(f"{idx + 1}. 제목: {title}")
    print(f"   조치사항: {action} (거리: {dist})")
